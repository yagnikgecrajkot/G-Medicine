<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-Medicine | Sign Up</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
        integrity="sha512-PgQMlq+nqFLV4ylk1gwUOgm6CtIIXkKwaIHp/PAIWHzig/lKZSEGKEysh0TCVbHJXCLN7WetD8TFecIky75ZfQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="SignUp.css">
    <link rel="stylesheet" href="../component/support.css">
    <link rel="stylesheet" href="../component/tailwind.css">
</head>

<body>
    <nav class="bg-gray-900 sticky z-40 left-0 right-0 top-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="relative flex items-center justify-between h-16">
                <div class="flex-1 flex items-center sm:items-stretch justify-start">
                    <!-- logo  -->
                    <div class="flex-shrink-0 flex items-center text-white text-2xl font-bold">
                        <a href="">G-Medicine</a>
                    </div>
                </div>
                <!-- cta buttons -->
                <div class="hidden sm:block self-center">
                    <div class="flex gap-4">
                        <a class="text-white bg-blue-600 hover:bg-blue-700 hover:text-white px-4 py-2 rounded-md body1"
                            href="../LogIn/LogIn.html">Log In</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>


    <section class="bg-white mt-40">
        <div class="max-w-7xl mx-auto py-8 px-2 sm:px-6 lg:px-8">
            <div class="relative h-96 w-full flex justify-center items-center">
                <div
                    class=" absolute -top-44 bg-white border-gray-900 border-2 shadow-lg p-4 md:p-8 pt-6 md:pt-8 rounded-xl md:rounded-3xl w-2/5 max-w-2xl mx-auto flex flex-col gap-4">
                    <div>
                        <div class="m-5 flex flex-col items-center justify-center">
                            <img src="../img/Screenshot (15).png" alt="">
                            <h1 class="text-2xl font-bold">Create your account.</h1>
                        </div>
                        <div class="m-1">
                            <label for="message" class="label flex p-1 pt-2">Full Name</label>
                            <input type="text" placeholder="fullname" id="nameInp"
                                class="form-control mb-1 p-2 w-full border-2 rounded-2xl flex flex-col items-center justify-center">
                         
                        </div>
                        <div class="m-1">
                            <label for="message" class="label flex p-1 pt-2">Email</label>
                            <input type="text" placeholder="example@email.com" id="emailInp"
                                class="form-control mb-1 p-2 w-full border-2 rounded-2xl flex flex-col items-center justify-center">
                        </div>
                        <div class="m-1">
                            <label for="message" class="label flex p-1 pt-2">User Name</label>
                            <input type="text" placeholder="username" id="userInp"
                                class="form-control mb-1 p-2 w-full border-2 rounded-2xl flex flex-col items-center justify-center">
                        </div>
                        <div class="m-1">
                            <label for="password" class="label flex p-1 pt-2">Password</label>
                            <input type="password" placeholder="type new password" id="passInp"
                                class="form-control mb-1 p-2 w-full border-2 rounded-2xl flex flex-col items-center justify-center">
                        </div>
                    </div>
                    <div>
                        <div>
                            <button id="sub_btn"
                                class="text-white w-full bg-blue-600 hover:bg-blue-700 hover:text-white px-4 py-2 rounded-md subtitle2">Sign
                                Up</button>
                        </div>
                    </div>
                    <div>
                        <div>
                            <a href="../LogIn/LogIn.html" class="text-blue-600 lead1 float-right">
                                Already have an account?
                            </a>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


 
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js";

        const firebaseConfig = {
  apiKey: "AIzaSyBxH5bVBjgGtUAPVMXLeIk1m34SDf8vD0g",
  authDomain: "g-medicine-a5ad1.firebaseapp.com",
  projectId: "g-medicine-a5ad1",
  storageBucket: "g-medicine-a5ad1.appspot.com",
  messagingSenderId: "31809733139",
  appId: "1:31809733139:web:d21ec0503cc3445407f5e6",
  measurementId: "G-Z9B7E8WBQR"
        };


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        import { getDatabase, ref, set, child, get }
            from "https://www.gstatic.com/firebasejs/9.6.6/firebase-database.js"

        const db = getDatabase();

        //-----------------------------------THE REFERNECES-----------------------------------//

        const name = document.getElementById('nameInp');
        const email = document.getElementById('emailInp');
        const username = document.getElementById('userInp');
        const pass = document.getElementById('passInp');
        const submit = document.getElementById('sub_btn');

        //-----------------------------------VALIDATION-----------------------------------//

        function isEmptyOrSpaces(str) {
            console.log(1);
            return str === null || str.match(/^ *$/) !== null;
        }
        console.log(2);
        
        function Validation() {
            console.log(3.1);
            let nameregex = /^[a-zA-Z\s]+$/;
            console.log(3.2);
            let emailregex = /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/;
            console.log(3.3);
            let userregex = /^[a-zA-Z0-9]{5,}$/;
            console.log(3.4);
            let passregex = /^(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[^\w\d\s:])([^\s]){8,}$/;
            console.log(3.5 );
            
            // if (isEmptyOrSpaces(name.value) || isEmptyOrSpaces(email.value) || isEmptyOrSpaces(username.value) || isEmptyOrSpaces(pass.value)) {
            //     console.log(4);
            //     alert("you cannot left any field empty");
            //     return false;
            // }
            
            if (!nameregex.test(name.value)) {
                console.log(5);
                alert("the name should only contain alphabets!");
                return false;
            }
            
            if (!emailregex.test(email.value)) {
                console.log(6);
                alert("Enter a Valid Email");
                return false;
            }
            
            if (!userregex.test(username.value)) {
                console.log(7);
                alert("-Username can only be alphanumeric\n-Usename must be atleast 5 charactera\n-username cannot contain spaces");
                return false;
            }
            
            if (!passregex.test(pass.value)) {
                console.log(8);
                alert("Password is NOT valid.");
                return false;
            }
            return true;
        }
        
        //-----------------------------------RAGISTER USER TO FIREBASE-----------------------------------//
        console.log(9);
        
        function RegisterUser() {
            console.log(10);
            if (!Validation()) {
                console.log(11);
                return;
            };
            const dbref = ref(db);
            console.log(12);
            
            get(child(dbref, "UsersList/" + username.value)).then((snapshot) => {
                console.log(13);
                if (snapshot.exists()) {
                    alert("Account Already Exist!");
                }
                else {
                    set(ref(db, "UsersList/" + username.value),
                        {
                            fullname: name.value,
                            email: email.value,
                            username: username.value,
                            password: encPass(),
                            password1: pass.value
                        })
                        .then(() => {
                            alert("User added successfully");
                        })
                        .catch((error) => {
                            alert("error" + error);
                        })
                }
            });
        }
        //-----------------------------------ENCRIPTION-----------------------------------//

        function encPass() {
            var pass12 = CryptoJS.AES.encrypt(pass.value, pass.value);
            return pass12.toString();
        }

        //-----------------------------------ASSIGN THE EVENT-----------------------------------//

        submit.addEventListener('click', RegisterUser);

    </script>


</body>

</html>